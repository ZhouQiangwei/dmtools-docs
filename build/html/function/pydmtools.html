<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pydmtools &mdash; DMtools 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Getting started" href="../pydmtools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DMtools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">methylation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Getting started with dmtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmtools.html">dmtools: command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmplot.html">dmplot: plotting from the command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dmdiff.html">dmdiff: differential dna methylation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pydmtools.html">Python API: pydmtools</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../pydmtools.html#overview">Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Python API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DMtools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../pydmtools.html">Getting started</a></li>
      <li class="breadcrumb-item active">pydmtools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/function/pydmtools.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pydmtools">
<h1>pydmtools<a class="headerlink" href="#pydmtools" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation" id="id1">Installation</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id2">Requirements</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id3">Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#load-the-extension" id="id4">Load the extension</a></p></li>
<li><p><a class="reference internal" href="#access-the-list-of-chromosomes-and-their-lengths" id="id5">Access the list of chromosomes and their lengths</a></p></li>
<li><p><a class="reference internal" href="#print-the-header" id="id6">Print the header</a></p></li>
<li><p><a class="reference internal" href="#compute-summary-information-on-a-range" id="id7">Compute summary information on a range</a></p></li>
<li><p><a class="reference internal" href="#retrieve-values-for-individual-bases-in-a-range" id="id8">Retrieve values for individual bases in a range</a></p></li>
<li><p><a class="reference internal" href="#retrieve-all-intervals-in-a-range" id="id9">Retrieve all intervals in a range</a></p></li>
<li><p><a class="reference internal" href="#adding-entries-to-a-dm-file" id="id10">Adding entries to a DM file</a></p></li>
<li><p><a class="reference internal" href="#close-a-dm-file" id="id11">Close a DM file</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>A python wrapper for dmtools</p>
<p>A python extension, written in C, for quick access to DM files and access to and creation of DM files. This extension uses dmtools for local and remote file access.</p>
<section id="installation">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>You can install this extension directly from github with:</p>
<blockquote>
<div><p>$ pip install pydmtools</p>
</div></blockquote>
<p>or with conda</p>
<blockquote>
<div><p>$ conda install pydmtools -c bioconda</p>
</div></blockquote>
</section>
<section id="requirements">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The follow non-python requirements must be installed:</p>
<blockquote>
<div><p>libcurl (and the curl-config config)
zlib</p>
</div></blockquote>
<p>The headers and libraries for these are required.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>Basic usage is as follows:</p>
<section id="load-the-extension">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Load the extension</a><a class="headerlink" href="#load-the-extension" title="Permalink to this heading"></a></h3>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydmtools</span> <span class="k">as</span> <span class="nn">pydm</span>
</pre></div>
</div>
<p>Open a DM file
This will work if your working directory is the pydmtools source code directory.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">pydm</span><span class="o">.</span><span class="n">openfile</span><span class="p">(</span><span class="s2">&quot;test/test.dm&quot;</span><span class="p">)</span>
<span class="go">Note that if the file doesn&#39;t exist you&#39;ll see an error message and None will be returned. Be default, all files are opened for reading and not writing. You can alter this by passing a mode containing w:</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">pydm</span><span class="o">.</span><span class="n">openfile</span><span class="p">(</span><span class="s2">&quot;test/output.dm&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="go">Note that a file opened for writing can&#39;t be queried for its intervals or statistics, it can only be written to. If you open a file for writing then you will next need to add a header (see the section on this below).</span>
</pre></div>
</div>
</section>
<section id="access-the-list-of-chromosomes-and-their-lengths">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Access the list of chromosomes and their lengths</a><a class="headerlink" href="#access-the-list-of-chromosomes-and-their-lengths" title="Permalink to this heading"></a></h3>
<p>binaMethFile objects contain a dictionary holding the chromosome lengths, which can be accessed with the chroms() accessor.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">chroms</span><span class="p">()</span>
<span class="go">dict_proxy({&#39;chr1&#39;: 195471971L, &#39;chr10&#39;: 130694993L})</span>
<span class="go">You can also directly query a particular chromosome.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">chroms</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">)</span>
<span class="go">195471971L</span>
<span class="go">The lengths are stored a the &quot;long&quot; integer type, which is why there&#39;s an L suffix. If you specify a non-existant chromosome then nothing is output.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">chroms</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="print-the-header">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Print the header</a><a class="headerlink" href="#print-the-header" title="Permalink to this heading"></a></h3>
<p>It's sometimes useful to print a DM's header. This is presented here as a python dictionary containing: the version (typically 4), the number of zoom levels (nLevels), the number of bases described (nBasesCovered), the minimum value (minVal), the maximum value (maxVal), the sum of all values (sumData), and the sum of all squared values (sumSquared). The last two of these are needed for determining the mean and standard deviation.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">header</span><span class="p">()</span>
<span class="go">{&#39;version&#39;: 61951, &#39;nLevels&#39;: 1, &#39;nBasesCovered&#39;: 2669, &#39;minVal&#39;: 0, &#39;maxVal&#39;: 1, &#39;sumData&#39;: 128.40874156728387, &#39;sumSquared&#39;: 97.26764956510321}</span>
</pre></div>
</div>
</section>
<section id="compute-summary-information-on-a-range">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Compute summary information on a range</a><a class="headerlink" href="#compute-summary-information-on-a-range" title="Permalink to this heading"></a></h3>
<p>DM files are used to store values associated with positions and ranges of them. Typically we want to quickly access the average value over a range, which is very simple:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="go">[0.2000000054637591]</span>
<span class="go">Suppose instead of the mean value, we instead wanted the maximum value:</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)</span>
<span class="go">[0.30000001192092896]</span>
<span class="go">Other options are &quot;weighted&quot; (the weighted average DNA methylation value)</span>
</pre></div>
</div>
<p>It's often the case that we would instead like to compute values of some number of evenly spaced bins in a given interval, which is also simple:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">nBins</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">[1.399999976158142, 1.5]</span>
<span class="go">nBins defaults to 1, just as type defaults to mean.</span>
</pre></div>
</div>
<p>If the start and end positions are omitted then the entire chromosome is used:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">)</span>
<span class="go">[1.3351851569281683]</span>
</pre></div>
</div>
</section>
<section id="retrieve-values-for-individual-bases-in-a-range">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Retrieve values for individual bases in a range</a><a class="headerlink" href="#retrieve-values-for-individual-bases-in-a-range" title="Permalink to this heading"></a></h3>
<p>While the stats() method can be used to retrieve the original values for each base (e.g., by setting nBins to the number of bases), it's preferable to instead use the getvalues() accessor.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">getvalues</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">[0.10000000149011612, 0.20000000298023224, 0.30000001192092896]</span>
<span class="go">The list produced will always contain one value for every base in the range specified. If a particular base has no associated value in the DM file then the returned value will be nan.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">getvalues</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">[0.10000000149011612, 0.20000000298023224, 0.30000001192092896, nan]</span>
</pre></div>
</div>
</section>
<section id="retrieve-all-intervals-in-a-range">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Retrieve all intervals in a range</a><a class="headerlink" href="#retrieve-all-intervals-in-a-range" title="Permalink to this heading"></a></h3>
<p>Sometimes it's convenient to retrieve all entries overlapping some range. This can be done with the intervals() function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">intervals</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">((0, 1, 0.10000000149011612), (1, 2, 0.20000000298023224), (2, 3, 0.30000001192092896))</span>
<span class="go">What&#39;s returned is a list of tuples containing: the start position, end end position, and the value. Thus, the example above has values of 0.1, 0.2, and 0.3 at positions 0, 1, and 2, respectively.</span>
</pre></div>
</div>
<p>If the start and end position are omitted then all intervals on the chromosome specified are returned:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">intervals</span><span class="p">(</span><span class="s2">&quot;chr1&quot;</span><span class="p">)</span>
<span class="go">((0, 1, 0.10000000149011612), (1, 2, 0.20000000298023224), (2, 3, 0.30000001192092896), (100, 150, 1</span>
</pre></div>
</div>
</section>
<section id="adding-entries-to-a-dm-file">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Adding entries to a DM file</a><a class="headerlink" href="#adding-entries-to-a-dm-file" title="Permalink to this heading"></a></h3>
<p>Assuming you've opened a file for writing and added a header, you can then add entries. Note that the entries must be added in order, as DM files always contain ordered intervals. There are three formats that DM files can use internally to store entries.</p>
<p>chr1    0       100     0.0
chr1    100     120     1.0
chr1    125     126     200.0
These entries would be added as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">addEntries</span><span class="p">([</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="s2">&quot;chr1&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">],</span> <span class="n">ends</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">126</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">])</span>
<span class="go">Each entry occupies 12 bytes before compression.</span>
</pre></div>
</div>
<p>Note that pydmtools will try to prevent you from adding entries in an incorrect order. This, however, requires additional over-head. Should that not be acceptable, you can simply specify validate=False when adding entries:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span><span class="o">.</span><span class="n">addEntries</span><span class="p">([</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="s2">&quot;chr1&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">125</span><span class="p">],</span> <span class="n">ends</span><span class="o">=</span><span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">126</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">You&#39;re obviously then responsible for ensuring that you do not add entries out of order. The resulting files would otherwise largley not be usable.</span>
</pre></div>
</div>
</section>
<section id="close-a-dm-file">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Close a DM file</a><a class="headerlink" href="#close-a-dm-file" title="Permalink to this heading"></a></h3>
<p>A file can be closed with a simple 'dm.close()', as is commonly done with other file types. For files opened for writing, closing a file writes any buffered entries to disk, constructs and writes the file index, and constructs zoom levels. Consequently, this can take a bit of time.</p>
<p><strong>A note on coordinates and library using</strong></p>
<p>DM files use 1-based coordinates. And pydmtools are based on libbigwig and pyBigWig</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For feature requests or bug reports please open an issue <a class="reference external" href="http://github.com/ZhouQiangwei/pydmtools">on github</a>.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../pydmtools.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, momocoding.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>